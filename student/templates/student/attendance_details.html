{% extends "student/base.html" %}

{% block content %}
<div class="container mt-4">
    
    
    <!-- Month Selection -->
    <div class="d-flex justify-content-center mb-3">
        <label for="monthSelect" class="me-2">Select Month:</label>
        <select id="monthSelect" class="form-select w-auto">
            {% for month in months %}
            <option value="{{ month.value }}" {% if month.value == current_month %}selected{% endif %}>
                {{ month.name }}
            </option>
            {% endfor %}
        </select>
    </div>

    <!-- Calendar -->
    <div id="calendar"></div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        var calendarEl = document.getElementById('calendar');
        var calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'dayGridMonth',
            headerToolbar: {
                left: 'prev,next today',
                center: 'title',
                right: 'dayGridMonth'
            },
            events: function(fetchInfo, successCallback, failureCallback) {
                let selectedMonth = document.getElementById('monthSelect').value;
                fetch(`/attendance-data/?month=${selectedMonth}`)
                .then(response => response.json())
                .then(data => successCallback(data))
                .catch(error => failureCallback(error));
            },
            eventDidMount: function (info) {
                let statusColors = {
                    "Present": "green",
                    "Absent": "red",
                    "Half-Day": "lightgreen",
                    "Holiday": "orange",
                    "Weekly Off": "yellow"
                };
                info.el.style.backgroundColor = statusColors[info.event.extendedProps.status] || "blue";
            }
        });

        calendar.render();

        // Update calendar when month is changed
        document.getElementById('monthSelect').addEventListener('change', function () {
            calendar.refetchEvents();
        });
    });
</script>
{% endblock %}
